# ota-bridge

大阪ミナミの「空室＆平均価格カレンダー（vacancy-dashboard）」に対して、  
**楽天・じゃらんの口コミ指標と日別最安料金**を“橋渡し”するための収集・集約（ETL）リポジトリです。

## 目的
- 楽天・じゃらんから **口コミ平均／件数**（日次スナップショット）を取得・保存
- 楽天APIから **日付×ホテルの最安料金** を取得・保存
- 生成データを JSON で公開し、UI 側（vacancy-dashboard）で参照可能にする
- 本番ローンチまでは UI からは読み込まず、**こちらで安定運用を確認**してから切替

## 生成予定のJSON（MVP）
- `data/ota_facility_meta.json`  
  - 日次スナップショット：ホテルIDごとの 口コミ平均・件数（楽天／じゃらん）、`date`、`last_updated`
- `data/competitor_min_prices.json`  
  - `YYYY-MM-DD` をキーに、ホテルIDごとの最安値（楽天）
- `data/hotel_master.json`（手動管理）  
  - ホテルID／正式名称／総客室数 などのマスタ

> 失敗日があっても **0/NaN は出さず**、原則 **前回値を保持** します。

## スケジュール（JST）
- 08:45 収集（GitHub Actions）→ JSON 更新  
- 09:00 は従来通り UI 側が更新（ただしローンチまでは ota-bridge の JSON は未参照）

## 秘密情報（Secrets）
- **RAKUTEN_APP_ID**：楽天トラベル API のアプリID  
- （じゃらん Webサービスはキー制、必要になった段階で追加）

## 運用ポリシー
- UI と収集処理を分離（**別リポ**）し、現場運用への影響を最小化
- ローンチまで UI は機能フラグOFF。**このリポのみで動作確認**を完了させる
- 規約・負荷に配慮（頻度は日次、待機・リトライ実装、User-Agent 明示）

## 今後の流れ
1. `data/hotel_master.json` を作成（手動でホテル登録）
2. 取得ワークフローの雛形を追加（まずはダミーJSONを書き出して配信確認）
3. 楽天API → 口コミ・最安値の実データ出力に切替
4. じゃらん 口コミ平均／件数の追加
5. 安定運用確認後、UI 側の機能フラグON
